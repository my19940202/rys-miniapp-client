<view class="map-container">
  <!-- é¡¶éƒ¨å›ºå®šTabs -->
  <view class="tabs-wrapper">
    <t-tabs value="{{currentTab}}" bind:change="onTabChange" theme="tag">
      <t-tab-panel 
        wx:for="{{categories}}" 
        wx:key="value"
        label="{{item.emoji}} {{item.label}}" 
        value="{{item.value}}"
      />
    </t-tabs>
  </view>

  <!-- åœ°å›¾ç»„ä»¶ -->
  <map
    id="scenic-map"
    class="map"
    latitude="{{mapCenter.latitude}}"
    longitude="{{mapCenter.longitude}}"
    scale="{{scale}}"
    markers="{{markers}}"
    polyline="{{polylines}}"
    show-location
    bindmarkertap="onMarkerTap"
  >
    <!-- å·¦ä¸‹è§’æ§åˆ¶æŒ‰é’®ç»„ -->
    <cover-view class="control-group left-bottom">
      <cover-view class="control-btn" bindtap="handleZoom" data-action="in">
        <cover-view class="btn-text">+</cover-view>
      </cover-view>
      <cover-view class="control-btn" bindtap="handleZoom" data-action="out">
        <cover-view class="btn-text">-</cover-view>
      </cover-view>
      <cover-view class="control-btn" bindtap="handleLocation">
        <cover-view class="btn-text">ğŸ“</cover-view>
      </cover-view>
    </cover-view>

    <!-- å³ä¸Šè§’è·¯çº¿æŒ‰é’® -->
    <cover-view class="control-group right-top">
      <cover-view class="control-btn route-btn {{showRoute ? 'active' : ''}}" bindtap="toggleRoute">
        <cover-view class="btn-text">{{showRoute ? 'éšè—' : 'è·¯çº¿'}}</cover-view>
      </cover-view>
    </cover-view>
  </map>

  <!-- æ™¯ç‚¹è¯¦æƒ…å¼¹çª— -->
  <t-popup
    visible="{{showPopup}}"
    bind:visible-change="closePopup"
    placement="bottom"
    close-on-overlay-click
  >
    <view class="popup-content" wx:if="{{currentSpot}}">
      <view class="popup-header">
        <view class="spot-emoji">{{currentSpot.emoji}}</view>
        <view class="spot-title">{{currentSpot.title}}</view>
      </view>
      
      <!-- æ™¯ç‚¹å›¾ç‰‡ï¼ˆå¦‚æœæœ‰ï¼‰ -->
      <view class="spot-images" wx:if="{{currentSpot.images && currentSpot.images.length > 0}}">
        <image 
          wx:for="{{currentSpot.images}}" 
          wx:key="index"
          src="{{item}}" 
          class="spot-image"
          mode="aspectFill"
        />
      </view>
      
      <!-- æ™¯ç‚¹æè¿° -->
      <view class="spot-description">
        {{currentSpot.description}}
      </view>
      
      <!-- è¯­éŸ³è®²è§£æŒ‰é’® -->
      <view class="audio-section">
        <t-button theme="primary" size="medium" bindtap="playAudio" block>
          ğŸ”Š è¯­éŸ³è®²è§£
        </t-button>
      </view>
      
      <!-- å…³é—­æŒ‰é’® -->
      <view class="close-btn" bindtap="closePopup">
        <t-button theme="light" size="small" block>å…³é—­</t-button>
      </view>
    </view>
  </t-popup>
</view>
