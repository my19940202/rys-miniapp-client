<view class="map-container">
  <!-- 顶部固定Tabs -->
  <view class="tabs-wrapper">
    <t-tabs value="{{currentTab}}" bind:change="onTabChange" theme="tag">
      <t-tab-panel 
        wx:for="{{categories}}" 
        wx:key="value"
        label="{{item.emoji}} {{item.label}}" 
        value="{{item.value}}"
      />
    </t-tabs>
  </view>

  <!-- 地图组件 -->
  <map
    id="scenic-map"
    class="map"
    latitude="{{mapCenter.latitude}}"
    longitude="{{mapCenter.longitude}}"
    scale="{{scale}}"
    markers="{{markers}}"
    polyline="{{polylines}}"
    show-location
    bindmarkertap="onMarkerTap"
    bindcallouttap="onMarkerTap"
  >
  </map>

  <!-- 左下角控制按钮组 -->
  <view class="control-group right-bottom">
    <view class="control-btn" bindtap="handleZoom" data-action="in">
      <t-icon name="plus" size="40rpx" color="#333" />
    </view>
    <view class="control-btn" bindtap="handleZoom" data-action="out">
      <t-icon name="minus" size="40rpx" color="#333" />
    </view>
    <view class="control-btn" bindtap="handleLocation">
      <t-icon name="location" size="40rpx" color="#333" />
    </view>
  </view>

  <!-- 右上角路线按钮 -->
  <view class="control-group right-top">
    <view class="control-btn route-btn {{showRoute ? 'active' : ''}}" bindtap="toggleRoute">
      <view class="btn-text">{{showRoute ? '隐藏' : '路线'}}</view>
    </view>
  </view>

  <!-- 景点详情弹窗 -->
  <t-popup
    visible="{{showPopup}}"
    bind:visible-change="closePopup"
    placement="bottom"
    close-on-overlay-click
  >
    <view class="popup-content" wx:if="{{currentSpot}}">
      <view class="popup-header">
        <view class="spot-title">{{currentSpot.name}}</view>
      </view>
      
      <!-- 景点图片（如果有） -->
      <view class="spot-images" wx:if="{{currentSpot.images && currentSpot.images.length > 0}}">
        <image
          src="{{currentSpot.images[0]}}"
          class="spot-image"
          mode="aspectFill"
        />
      </view>
      
      <!-- 景点描述 -->
      <view class="spot-description text-ellipsis" wx:if="{{currentSpot.description}}">
        <text>{{currentSpot.description}}</text>
      </view>
      
      <!-- 语音讲解按钮 -->
      <view class="audio-section" wx:if="{{currentSpot.audio && currentSpot.audio.url}}">
        <view class="audio-player" bindtap="toggleAudio">
          <t-icon name="{{isAudioPlaying ? 'pause-circle-stroke' : 'sound'}}" size="44rpx" />
          <view class="audio-duration">{{audioTimeDisplay}}</view>
        </view>
      </view>
      
      <!-- 查看详情按钮 -->
      <t-button bindtap="goToDetail" theme="primary" block>查看详情</t-button>
    </view>
  </t-popup>
</view>
